<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Retro Emoji Snake</title>
  <style>
    :root{--size:20px;--cols:24;--rows:18}
    html,body{height:100%;margin:0;background:#111;color:#fff;font-family:monospace;display:flex;align-items:center;justify-content:center}
    .wrap{display:flex;flex-direction:column;align-items:center;gap:12px}
    canvas{image-rendering:pixelated;background:#071;box-shadow:0 8px 30px rgba(0,0,0,.6);border:6px solid #222}
    .hud{display:flex;gap:12px;align-items:center}
    .btn{background:#222;border:1px solid #555;padding:6px 10px;border-radius:6px;color:#fff;cursor:pointer}
    .small{font-size:0.9rem;color:#ccc}
    .retro{letter-spacing:2px;font-weight:700}
    @media (max-width:600px){:root{--cols:18;--rows:14;--size:18px}}
  </style>
</head>
<body>
  <div class="wrap">
    <div style="text-align:center">
      <div class="retro">RETRO SNAKE</div>
      <div class="small">Use ‚Üë ‚Üì ‚Üê ‚Üí or W A S D ‚Äî Eat the üçé ‚Äî Don't hit walls</div>
    </div>

    <canvas id="screen" width="calc(var(--cols) * var(--size))" height="calc(var(--rows) * var(--size))"></canvas>

    <div class="hud">
      <div>Score: <span id="score">0</span></div>
      <div>Level: <span id="level">1</span></div>
      <button id="start" class="btn">Start</button>
      <button id="restart" class="btn">Restart</button>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('screen');
    const ctx = canvas.getContext('2d');
    // compute grid from CSS variables
    const style = getComputedStyle(document.documentElement);
    const COLS = parseInt(style.getPropertyValue('--cols')) || 24;
    const ROWS = parseInt(style.getPropertyValue('--rows')) || 18;
    const SIZE = parseInt(style.getPropertyValue('--size')) || 20;

    canvas.width = COLS * SIZE;
    canvas.height = ROWS * SIZE;

    const scoreEl = document.getElementById('score');
    const levelEl = document.getElementById('level');
    const startBtn = document.getElementById('start');
    const restartBtn = document.getElementById('restart');

    // Game state
    let snake = [{x: Math.floor(COLS/2), y: Math.floor(ROWS/2)}];
    let dir = {x:1,y:0};
    let nextDir = {x:1,y:0};
    let food = null;
    let running = false;
    let score = 0;
    let level = 1;
    let speed = 8; // ticks per second
    let tickTimer = 0;
    const FOOD_EMOJI = 'üçé';
    const SNAKE_HEAD = 'üê∂';
    const SNAKE_BODY = 'üü´'; // body (emoji block)

    // Retro grid background
    function drawBackground(){
      ctx.fillStyle = '#071';
      ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = 'rgba(0,0,0,0.15)';
      for(let x=0;x<COLS;x++){
        for(let y=0;y<ROWS;y++){
          if((x+y)%2===0){
            ctx.fillRect(x*SIZE,y*SIZE,SIZE,SIZE);
          }
        }
      }
    }

    function drawEmoji(ch, x, y){
      // draw emoji centered
      ctx.font = Math.floor(SIZE*0.95) + 'px monospace';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText(ch, x*SIZE + SIZE/2, y*SIZE + SIZE/2 + 1);
    }

    function placeFood(){
      while(true){
        const fx = Math.floor(Math.random()*COLS);
        const fy = Math.floor(Math.random()*ROWS);
        if(!snake.some(s=>s.x===fx && s.y===fy)){
          food = {x:fx,y:fy};
          return;
        }
      }
    }

    function reset(){
      snake = [{x: Math.floor(COLS/2), y: Math.floor(ROWS/2)}];
      dir = {x:1,y:0};
      nextDir = {x:1,y:0};
      score = 0; level = 1; speed = 8; running = false; food = null;
      scoreEl.textContent = score; levelEl.textContent = level;
      draw();
    }

    function start(){
      if(!running){
        running = true;
        if(!food) placeFood();
      }
    }

    function gameOver(){
      running = false;
      // show overlay using alert style but retro
      setTimeout(()=>{
        const play = confirm('GAME OVER - Score: '+score+'\nPlay again?');
        if(play) reset(), start();
      }, 50);
    }

    function update(){
      // move on tick
      if(!running) return;
      dir = nextDir; // accept next direction
      const head = {x: snake[0].x + dir.x, y: snake[0].y + dir.y};

      // wall collision
      if(head.x < 0 || head.x >= COLS || head.y < 0 || head.y >= ROWS){
        gameOver();
        return;
      }

      // self collision
      if(snake.some(seg => seg.x === head.x && seg.y === head.y)){
        gameOver();
        return;
      }

      snake.unshift(head);

      // eat food
      if(food && head.x === food.x && head.y === food.y){
        score++;
        scoreEl.textContent = score;
        // speed up every 5 points
        if(score % 5 === 0){ level++; levelEl.textContent = level; speed += 2; }
        placeFood();
      } else {
        snake.pop();
      }
    }

    function draw(){
      drawBackground();
      // draw food
      if(food) drawEmoji(FOOD_EMOJI, food.x, food.y);
      // draw snake
      for(let i=0;i<snake.length;i++){
        const seg = snake[i];
        if(i===0) drawEmoji(SNAKE_HEAD, seg.x, seg.y);
        else drawEmoji(SNAKE_BODY, seg.x, seg.y);
      }
    }

    // main loop (timed ticks)
    let last = performance.now();
    function loop(now){
      const dt = (now - last)/1000;
      last = now;
      if(running){
        tickTimer += dt;
        const interval = 1 / speed;
        if(tickTimer >= interval){
          tickTimer -= interval;
          update();
        }
      }
      draw();
      requestAnimationFrame(loop);
    }

    // input
    window.addEventListener('keydown', e=>{
      const key = e.key.toLowerCase();
      if(['arrowup','w'].includes(e.key.toLowerCase())){
        if(dir.y !== 1) nextDir = {x:0,y:-1};
      } else if(['arrowdown','s'].includes(e.key.toLowerCase())){
        if(dir.y !== -1) nextDir = {x:0,y:1};
      } else if(['arrowleft','a'].includes(e.key.toLowerCase())){
        if(dir.x !== 1) nextDir = {x:-1,y:0};
      } else if(['arrowright','d'].includes(e.key.toLowerCase())){
        if(dir.x !== -1) nextDir = {x:1,y:0};
      } else if(e.key === ' '){ // space to start
        start();
      }
    });

    startBtn.addEventListener('click', ()=>start());
    restartBtn.addEventListener('click', ()=>{ reset(); start(); });

    // init
    reset();
    placeFood();
    requestAnimationFrame(loop);
  </script>
</body>
</html>
